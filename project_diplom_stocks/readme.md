# Управление сложными товарными запасами: кластеризаиция, рекомендации, отчетность

## Постановка задачи

Торговая компания, в которой я работаю, занимается дистрибуцией типовых расходников для сегмента HoReCa. Суть бизнеса состоит в том, что компания стремиться иметь а ассортименте "все для HoReCa, кроме продуктов питания и оборудования". От зубочистки до салфетки, от химии для уборки до упаковки, от одноразового стакана, до перчаток. Из-за этого компания имеет более 200 поставщиков и более 10000 товарных позиций. Однако такой ассортимент является не только конкурентным преимуществом, но и проблемой. А именно: управлять таким товарным запасом на нескольких складах сложно. Много позиций возятся под одного-двух клиентов на каждом конкретном складе. В данный момент есть baseline-решение, которое применяется:
* Алгоритм заказа применяется +/- стандартный. Товар заказывается исходя средних продаж.
* Товары деляться на группы, к которым существуют разные подходы. Эти группы "новинки", "неликвиды", и "остальное"
* Ключевым показателем при этом является оборачиваемость товарного запаса

Однако данный подход не устраивает в компании примерно никого. Из-за того что ассортимент сложный, очевидно, что невозможно применять "одинаковые алгоритмы" к заказу разных товаров.

В связи с этим в этом проекте я поставил перед собой следующие цели:
* Применить кластеризацию, для того, чтобы понять на какие группы оптимально разделить ассортимент с точки зрения управления товарным запасом
* Интерпретировать полученные кластеры с точки зрения эффективности товарного запаса
* Создать правило/алгоритм, который будет производить это деление для оперативных данных
* Создать наглядную систему отчетности текущую и с сохранением истории в динамике, которая будет наглядна и позволит быстро видеть "проблемы", которая будет использовать полученые кластеры
* Создать систему рекомендаций по оперативному заказу поставщикам, которая будет учитывать деление товаров на кластеры и информировать оператора-закупщика о степени доверия к рекомендациям

## Краткая информация о данных

У меня есть доступ к управлению торговлей 1С УТ11 по трем филиалам в Казахстане, за которые я отвечаю.
Через ИТ-отдел я достал выгрузки данных по дням по продажам, по остаткам, и с информацией о товаре (поставшики, ассортиментные группы, единицы измерения и т.п.)

Полем-ключем, связывающим эти три набора данных является поле АРТИКУЛ.

Первой задачей, которая решается в проекте - это сбор дата-сета, каждая строка которого - конкретный товар с каким-то набором признаков, для проведения кластеризации. Ведь делить на группы нам нудно именно товары.

Данные загружаются каждый раз за период 12 недель (условно 3 месяца). Такой период был рекомендован мне экспертом из отдела закупок.

Данные организованы таким образом, чтобы полученную модель можно было использовать на данных такого формата за любой 12-недельный период

Т.к. итоговый датасет собирается из 3х, подробное опсание исходных данных дано в ноутбуке project_stocks_ml на этапе загрузки и предобработки

На этапе построения модели кластеризации использованы данные одновременно по всем складам.

На этапах связанных с использованием готовой модели, данные применялись к одному складу, но для теста за 8 разных периодов

## Ноутбуки пректа
* *project_stocks_ml* - это первый ноутбук проекта. Он содержит основную часть связанную с машинным обучением
* *project_stocks_prod* - это второй ноутбук проекта. Он нужен, чтобы выполнить задачи проекта применению полученного алгоритма на практике. Там мы строим отчетность и рекомендации по заказу. А также по сути тестриуем модель на разных данных.

## Шаги работы над проектом 
1. Предобработка данных
    * Данные загружены в таблицы Sales - продажи по дням по каждому артикулу, Stocks - остатки по дням по каждому артикулу, Nomen - данные о товарах этого периода
    * Данные таблицы предобработаны, исследованы на пропуски и дубликаты
2. Генерация признаков и разведывательный анализ
    * На этом этапе на основании таблицы Nomen, создан датасает piv_nom (сводная по номенклатуре)
    * Созданы признаки, связанные с продажами и остатками:
        * Среднедневные продажи в штуках и деньгах
        * Средненедельные продажи в штуках и деньгах
        * Симметрия продаж (Растет или падают продажи в периоде)
        * Признаки связанные со статистическими параметрами продаж в день: стандартное отклонение, медианные продажи в день и неделю и т.д.
        * Признаки связанные с разряженностью данных (число дней с продажами)
        * Аналогичные всем признакам выше для остатков
        * Признаки товара связанные с клиентами: доля одного самого большого клиента покупающего этот товар, число покупающих клиентов
    * Исследованы признаки на необходимость логарифмирования
    * Созданы логарифмированные варианты части признаков по итогам исследования
3. Отбор признаков
    * По матрице корреляций признаков отобраны признаки для построения модели кластеризации
4. Преобразование признаков
    * Используем MinMaxScaler для преобразования признаков к единому масштабу. Все признаки заранее созданы числовыми.
5. Моделирование
    * Стрим 3 варианта кластеризации
        * Agglomerative
        * KMeans
        * КMeans после снижения размерности методом t-SNE
    * Сравниваем модели по качеству через коэфицент ситуаэта
    * Выбираем модель
6. Сериализуем готовую модель в файл для использования в продакшне
7. Дополнительные исследования для продакшна
    * Проводим дополнительное исследования признаков по полученным кластерам
    * Проверяем статистическую гипотезу для товаров кластера "Регулярные"
    * Принимаем решение по методологии вычисления признака уровня дефицита в зависимости от кластера

## Результаты
* Построена удобная модель деления товаров на группы по типу поведения
* Модель используется в рабочей практике сейчас
* Отчетность в разрезе кластеров очень удобна и наглядна, помогает задавать верные вопросы закупкам с управленческой точки зрения, а также ставить задачи
* Рекомендации используются уже некотороен время закупщиками в работе. Обратная связь положительная.
* Закупщики экономят кучу времени при работе с дефицитами и неликвидами

